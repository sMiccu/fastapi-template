# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“æ¦‚è¦

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ã€ã“ã®FastAPIãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®å…¨ä½“åƒã€å„ãƒ•ã‚¡ã‚¤ãƒ«ã®å½¹å‰²ã€å‹•ä½œã®ä»•çµ„ã¿ã‚’åŒ…æ‹¬çš„ã«èª¬æ˜ã—ã¾ã™ã€‚

---

## ğŸ“Š ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“åƒ

```
ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯3ã¤ã®å¤§ããªæŸ±ã§æ§‹æˆã•ã‚Œã¦ã„ã¾ã™ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³æœ¬ä½“ï¼ˆsrc/app/ï¼‰                â”‚
â”‚     - ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯                              â”‚
â”‚     - APIå®Ÿè£…                                       â”‚
â”‚     - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é€£æº                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. é–‹ç™ºåŸºç›¤ï¼ˆè¨­å®šãƒ»ãƒ„ãƒ¼ãƒ«ï¼‰                        â”‚
â”‚     - è‡ªå‹•åŒ–ã‚¹ã‚¯ãƒªãƒ—ãƒˆ                              â”‚
â”‚     - ã‚³ãƒ¼ãƒ‰å“è³ªç®¡ç†                                â”‚
â”‚     - é–‹ç™ºç’°å¢ƒ                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼ˆdocs/ï¼‰                           â”‚
â”‚     - è¨­è¨ˆæ–¹é‡                                      â”‚
â”‚     - ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„                              â”‚
â”‚     - å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å…¨ä½“å›³

### ãƒ¬ã‚¤ãƒ¤ãƒ¼æ§‹é€ 

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   HTTP Request                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Presentation Layer (presentation/api/)                 â”‚
â”‚  - FastAPI Router                                       â”‚
â”‚  - Pydanticã‚¹ã‚­ãƒ¼ãƒï¼ˆãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰                   â”‚
â”‚  - HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ãƒ¬ã‚¹ãƒãƒ³ã‚¹å¤‰æ›                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Application Layer (application/use_cases/)             â”‚
â”‚  - ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å®Ÿè¡Œ                                     â”‚
â”‚  - ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³åˆ¶å¾¡                                 â”‚
â”‚  - DTOï¼ˆCommand/Queryï¼‰                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Domain Layer (domain/)                                 â”‚
â”‚  - Entitiesï¼ˆãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ï¼‰                          â”‚
â”‚  - Value Objectsï¼ˆä¸å¤‰ãªå€¤ï¼‰                           â”‚
â”‚  - Repository Interfaceï¼ˆPortï¼‰                        â”‚
â”‚  - Domain Services                                      â”‚
â”‚  â˜… å¤–éƒ¨æŠ€è¡“ã«ä¾å­˜ã—ãªã„â˜…                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†‘ (å®Ÿè£…)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Infrastructure Layer (infrastructure/)                 â”‚
â”‚  - Repositoryå®Ÿè£…ï¼ˆAdapterï¼‰                            â”‚
â”‚  - SQLAlchemyãƒ¢ãƒ‡ãƒ«                                     â”‚
â”‚  - å¤–éƒ¨APIé€£æº                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Database (PostgreSQL)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ã¨å½¹å‰²

### ãƒ«ãƒ¼ãƒˆãƒ¬ãƒ™ãƒ«

```
fastapi-template/
â”œâ”€â”€ ğŸ“– ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼ˆä½¿ã„æ–¹ãƒ»è¨­è¨ˆï¼‰
â”‚   â”œâ”€â”€ CHEATSHEET.md          â­ æ—¥å¸¸çš„ã«è¦‹ã‚‹ï¼ˆã‚³ãƒãƒ³ãƒ‰ä¸€è¦§ï¼‰
â”‚   â”œâ”€â”€ QUICKSTART.md          åˆå›ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
â”‚   â”œâ”€â”€ CURSOR_GUIDE.md        Cursor AIæ´»ç”¨æ³•
â”‚   â”œâ”€â”€ PROJECT_OVERVIEW.md    ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆå…¨ä½“åƒï¼‰
â”‚   â””â”€â”€ README.md              ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆèª¬æ˜
â”‚
â”œâ”€â”€ ğŸ“š è©³ç´°ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
â”‚   â””â”€â”€ docs/
â”‚       â”œâ”€â”€ ARCHITECTURE.md    ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆåˆ¤æ–­
â”‚       â”œâ”€â”€ CONVENTIONS.md     ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„
â”‚       â”œâ”€â”€ DOMAIN_MODEL.md    ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«è¨­è¨ˆ
â”‚       â”œâ”€â”€ PATTERNS.md        å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³é›†
â”‚       â”œâ”€â”€ GIT_WORKFLOW.md    Git/ã‚³ãƒŸãƒƒãƒˆè¦ç´„
â”‚       â”œâ”€â”€ DEVELOPMENT.md     é–‹ç™ºè©³ç´°ã‚¬ã‚¤ãƒ‰
â”‚       â”œâ”€â”€ FOLDER_STRUCTURE.md ãƒ•ã‚©ãƒ«ãƒ€æ§‹é€ 
â”‚       â””â”€â”€ TECH_STACK.md      æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯
â”‚
â”œâ”€â”€ âš™ï¸ è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
â”‚   â”œâ”€â”€ pyproject.toml         Pythonè¨­å®šï¼ˆä¾å­˜é–¢ä¿‚ã€ruffã€mypyï¼‰
â”‚   â”œâ”€â”€ Makefile               ã‚¿ã‚¹ã‚¯ãƒ©ãƒ³ãƒŠãƒ¼ï¼ˆ50+ã‚³ãƒãƒ³ãƒ‰ï¼‰
â”‚   â”œâ”€â”€ Taskfile.yml           ä»£æ›¿ã‚¿ã‚¹ã‚¯ãƒ©ãƒ³ãƒŠãƒ¼
â”‚   â”œâ”€â”€ .cursorrules           Cursor AIãƒ«ãƒ¼ãƒ«
â”‚   â”œâ”€â”€ .pre-commit-config.yaml pre-commitãƒ•ãƒƒã‚¯è¨­å®š
â”‚   â””â”€â”€ alembic.ini            DBãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š
â”‚
â”œâ”€â”€ ğŸ³ ã‚³ãƒ³ãƒ†ãƒŠé–¢é€£
â”‚   â”œâ”€â”€ docker-compose.yml     é–‹ç™ºç’°å¢ƒï¼ˆPostgreSQL + Redisï¼‰
â”‚   â”œâ”€â”€ Dockerfile             æœ¬ç•ªç”¨ã‚¤ãƒ¡ãƒ¼ã‚¸
â”‚   â””â”€â”€ .devcontainer/         VSCode Dev Containerè¨­å®š
â”‚
â”œâ”€â”€ ğŸ¤– CI/CD
â”‚   â””â”€â”€ .github/workflows/ci.yml GitHub Actionsè¨­å®š
â”‚
â”œâ”€â”€ ğŸ› ï¸ ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”‚   â””â”€â”€ scripts/
â”‚       â”œâ”€â”€ setup.sh           ã‚¤ãƒ³ãƒ†ãƒªã‚¸ã‚§ãƒ³ãƒˆã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
â”‚       â”œâ”€â”€ auto-commit.sh     è‡ªå‹•ã‚³ãƒŸãƒƒãƒˆï¼†ãƒ—ãƒƒã‚·ãƒ¥
â”‚       â”œâ”€â”€ quick-fix.sh       ã‚ˆãã‚ã‚‹å•é¡Œã®è‡ªå‹•ä¿®æ­£
â”‚       â””â”€â”€ hooks/             Git hooks
â”‚
â”œâ”€â”€ ğŸ’» ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³æœ¬ä½“
â”‚   â””â”€â”€ src/app/
â”‚
â””â”€â”€ ğŸ§ª ãƒ†ã‚¹ãƒˆ
    â””â”€â”€ tests/
```

---

## ğŸ’» ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³æœ¬ä½“ï¼ˆsrc/app/ï¼‰

### æ§‹é€ 

```
src/app/
â”œâ”€â”€ main.py                    ğŸ“Œ ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”‚
â”œâ”€â”€ core/                      ğŸ” ã‚³ã‚¢æ©Ÿèƒ½ï¼ˆå…¨ä½“ã§å…±æœ‰ï¼‰
â”‚   â”œâ”€â”€ config.py              ç’°å¢ƒå¤‰æ•°ãƒ»è¨­å®šç®¡ç†
â”‚   â”œâ”€â”€ database.py            DBæ¥ç¶šãƒ»ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†
â”‚   â”œâ”€â”€ security.py            JWTèªè¨¼ãƒ»ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥
â”‚   â””â”€â”€ logging.py             æ§‹é€ åŒ–ãƒ­ã‚°è¨­å®š
â”‚
â”œâ”€â”€ shared/                    ğŸŒ å…±æœ‰ã‚³ãƒ¼ãƒ‰
â”‚   â”œâ”€â”€ exceptions.py          å…±é€šä¾‹å¤–éšå±¤
â”‚   â””â”€â”€ domain/
â”‚       â””â”€â”€ value_objects/     å…¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ä½¿ãˆã‚‹å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
â”‚           â”œâ”€â”€ money.py       é‡‘é¡ï¼ˆé€šè²¨è¨ˆç®—ï¼‰
â”‚           â”œâ”€â”€ email.py       ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
â”‚           â””â”€â”€ address.py     ä½æ‰€
â”‚
â”œâ”€â”€ modules/                   ğŸ“¦ æ©Ÿèƒ½ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆBounded Contextï¼‰
â”‚   â”œâ”€â”€ catalog/              ã€ã‚·ãƒ³ãƒ—ãƒ«ãªä¾‹ã€‘ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
â”‚   â””â”€â”€ orders/               ã€è¤‡é›‘ãªä¾‹ã€‘DDDãƒ•ãƒ«é©ç”¨
â”‚
â””â”€â”€ api/                       ğŸŒ APIçµ±åˆ
    â””â”€â”€ v1/
        â””â”€â”€ router.py          å…¨ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆé›†ç´„
```

---

## ğŸ¯ 2ã¤ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‘ã‚¿ãƒ¼ãƒ³

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯**ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ**ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚

### ãƒ‘ã‚¿ãƒ¼ãƒ³1: ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ï¼ˆmodules/catalog/ï¼‰

**ã„ã¤ä½¿ã†ï¼Ÿ**
- ã‚·ãƒ³ãƒ—ãƒ«ãªCRUDæ“ä½œ
- ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ãŒè–„ã„
- ä¾‹: å•†å“ä¸€è¦§ã€ã‚«ãƒ†ã‚´ãƒªç®¡ç†

**æ§‹é€ :**
```
modules/catalog/
â”œâ”€â”€ router.py            # FastAPI routesï¼ˆAPIå±¤ï¼‰
â”‚   â””â”€â”€ @router.get("/products")
â”‚
â”œâ”€â”€ schemas.py           # Pydanticãƒ¢ãƒ‡ãƒ«ï¼ˆãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
â”‚   â””â”€â”€ ProductResponse, ProductCreate
â”‚
â”œâ”€â”€ service.py           # ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯å±¤
â”‚   â””â”€â”€ ProductService.get_product()
â”‚
â”œâ”€â”€ repository.py        # ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹å±¤ï¼ˆå…·è±¡ã‚¯ãƒ©ã‚¹ï¼‰
â”‚   â””â”€â”€ ProductRepository.find_by_id()
â”‚
â”œâ”€â”€ models.py            # SQLAlchemyãƒ¢ãƒ‡ãƒ«
â”‚   â””â”€â”€ ProductModel (DBãƒ†ãƒ¼ãƒ–ãƒ«)
â”‚
â”œâ”€â”€ dependencies.py      # ä¾å­˜æ€§æ³¨å…¥
â”‚   â””â”€â”€ get_product_service()
â”‚
â””â”€â”€ exceptions.py        # ã‚«ã‚¿ãƒ­ã‚°å›ºæœ‰ã®ä¾‹å¤–
    â””â”€â”€ ProductNotFoundException
```

**ãƒ‡ãƒ¼ã‚¿ã®æµã‚Œ:**
```
1. HTTP Request
     â†“
2. router.pyï¼ˆãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
     â†“
3. service.pyï¼ˆãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ï¼‰
     â†“
4. repository.pyï¼ˆDBæ“ä½œï¼‰
     â†“
5. models.pyï¼ˆSQLAlchemyï¼‰
     â†“
6. Database
```

**å…·ä½“ä¾‹:**
```python
# APIå‘¼ã³å‡ºã—
GET /api/v1/products/{product_id}

# å‡¦ç†ã®æµã‚Œ
1. router.py:get_product()
   - ãƒªã‚¯ã‚¨ã‚¹ãƒˆå—ä¿¡
   - product_id ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

2. service.get_product(product_id)
   - ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯å®Ÿè¡Œï¼ˆè–„ã„ï¼‰

3. repository.find_by_id(product_id)
   - SQLã‚¯ã‚¨ãƒªå®Ÿè¡Œ

4. ProductModel ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿å–å¾—

5. ProductResponse ã«å¤‰æ›

6. JSON ãƒ¬ã‚¹ãƒãƒ³ã‚¹è¿”å´
```

---

### ãƒ‘ã‚¿ãƒ¼ãƒ³2: DDDãƒ•ãƒ«é©ç”¨ï¼ˆmodules/orders/ï¼‰

**ã„ã¤ä½¿ã†ï¼Ÿ**
- è¤‡é›‘ãªãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«
- é‡è¦ãªçŠ¶æ…‹é·ç§»
- å¤–éƒ¨é€£æºãŒè¤‡æ•°
- ä¾‹: æ³¨æ–‡å‡¦ç†ã€æ±ºæ¸ˆ

**æ§‹é€ :**
```
modules/orders/
â”œâ”€â”€ domain/                        ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ï¼ˆãƒ“ã‚¸ãƒã‚¹ã®æ ¸ï¼‰
â”‚   â”œâ”€â”€ entities/                  ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£
â”‚   â”‚   â”œâ”€â”€ order.py              Orderï¼ˆAggregate Rootï¼‰
â”‚   â”‚   â””â”€â”€ order_item.py         OrderItem
â”‚   â”‚
â”‚   â”œâ”€â”€ value_objects/            å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
â”‚   â”‚   â”œâ”€â”€ order_id.py           OrderIdï¼ˆè­˜åˆ¥å­ï¼‰
â”‚   â”‚   â”œâ”€â”€ order_status.py       OrderStatusï¼ˆçŠ¶æ…‹ï¼‰
â”‚   â”‚   â”œâ”€â”€ customer_id.py
â”‚   â”‚   â””â”€â”€ product_id.py
â”‚   â”‚
â”‚   â”œâ”€â”€ repositories/             ãƒªãƒã‚¸ãƒˆãƒªInterfaceï¼ˆPortï¼‰
â”‚   â”‚   â””â”€â”€ order_repository.py  ã€Œä½•ãŒå¿…è¦ã‹ã€ã‚’å®šç¾©
â”‚   â”‚
â”‚   â””â”€â”€ exceptions.py             ãƒ‰ãƒ¡ã‚¤ãƒ³ä¾‹å¤–
â”‚       â””â”€â”€ EmptyOrderError, OrderAlreadyConfirmedError
â”‚
â”œâ”€â”€ application/                   ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤
â”‚   â”œâ”€â”€ use_cases/                ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹
â”‚   â”‚   â”œâ”€â”€ create_order.py      æ³¨æ–‡ä½œæˆ
â”‚   â”‚   â”œâ”€â”€ add_item_to_order.py å•†å“è¿½åŠ 
â”‚   â”‚   â”œâ”€â”€ confirm_order.py     æ³¨æ–‡ç¢ºå®š
â”‚   â”‚   â””â”€â”€ get_order.py         æ³¨æ–‡å–å¾—
â”‚   â”‚
â”‚   â””â”€â”€ dto/                      ãƒ‡ãƒ¼ã‚¿è»¢é€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
â”‚       â””â”€â”€ commands.py           CreateOrderCommandç­‰
â”‚
â”œâ”€â”€ infrastructure/               ã‚¤ãƒ³ãƒ•ãƒ©å±¤ï¼ˆæŠ€è¡“çš„è©³ç´°ï¼‰
â”‚   â””â”€â”€ persistence/
â”‚       â”œâ”€â”€ models.py             SQLAlchemyãƒ¢ãƒ‡ãƒ«
â”‚       â””â”€â”€ order_repository_impl.py  Repositoryå®Ÿè£…ï¼ˆAdapterï¼‰
â”‚
â””â”€â”€ presentation/                 ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å±¤
    â”œâ”€â”€ api/
    â”‚   â”œâ”€â”€ router.py             FastAPI routes
    â”‚   â””â”€â”€ dependencies.py       DIè¨­å®š
    â”‚
    â””â”€â”€ schemas/                  APIç”¨ã‚¹ã‚­ãƒ¼ãƒ
        â”œâ”€â”€ request.py            ãƒªã‚¯ã‚¨ã‚¹ãƒˆDTO
        â””â”€â”€ response.py           ãƒ¬ã‚¹ãƒãƒ³ã‚¹DTO
```

**ãƒ‡ãƒ¼ã‚¿ã®æµã‚Œï¼ˆDDDãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰:**
```
1. HTTP Request
     â†“
2. presentation/api/router.py
   - CreateOrderRequestï¼ˆPydanticï¼‰ã§ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
   - DTOã«å¤‰æ›
     â†“
3. application/use_cases/create_order.py
   - CreateOrderCommand ã‚’å—ã‘å–ã‚‹
   - ãƒ“ã‚¸ãƒã‚¹ãƒ•ãƒ­ãƒ¼åˆ¶å¾¡
     â†“
4. domain/entities/order.py
   - Order.create() ã§ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ç”Ÿæˆ
   - ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«å®Ÿè¡Œï¼ˆä¾‹: add_item()ï¼‰
     â†“
5. domain/repositories/order_repository.py (Interface)
   - ã€Œä¿å­˜ã—ãŸã„ã€ã¨ã„ã†æŠ½è±¡çš„ãªè¦æ±‚
     â†“
6. infrastructure/persistence/order_repository_impl.py
   - å…·ä½“çš„ãªå®Ÿè£…ï¼ˆSQLAlchemyä½¿ç”¨ï¼‰
   - Entity â†’ Model å¤‰æ›
     â†“
7. infrastructure/persistence/models.py
   - OrderModelï¼ˆSQLAlchemyãƒ¢ãƒ‡ãƒ«ï¼‰
     â†“
8. Database
```

**å…·ä½“ä¾‹:**
```python
# APIå‘¼ã³å‡ºã—
POST /api/v1/orders/{order_id}/items
{
  "product_id": "uuid",
  "quantity": 2,
  "unit_price": 1000
}

# å‡¦ç†ã®æµã‚Œï¼ˆè©³ç´°ï¼‰

1. presentation/api/router.py:add_item_to_order()
   ãƒªã‚¯ã‚¨ã‚¹ãƒˆå—ä¿¡ã€AddItemRequest ã§ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

2. AddItemToOrderCommand ã«å¤‰æ›
   {
     order_id: "uuid",
     product_id: "uuid",
     quantity: 2,
     unit_price: Decimal(1000),
     currency: "JPY"
   }

3. application/use_cases/add_item_to_order.py:execute()
   a. order_repository.find_by_id() ã§ Orderå–å¾—
   b. ProductId, Money ã‚’ Value Object ã«å¤‰æ›
   c. order.add_item() ã‚’å‘¼ã³å‡ºã™ â† ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯

4. domain/entities/order.py:add_item()
   ã€ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«å®Ÿè¡Œã€‘
   - çŠ¶æ…‹ãƒã‚§ãƒƒã‚¯: status == PENDING?
   - æ•°é‡ãƒã‚§ãƒƒã‚¯: quantity > 0?
   - å¤±æ•—ãªã‚‰ä¾‹å¤–: OrderAlreadyConfirmedError
   - æˆåŠŸãªã‚‰: items ã«è¿½åŠ 

5. order_repository.save(order) ã§æ°¸ç¶šåŒ–

6. infrastructure/persistence/order_repository_impl.py:save()
   a. Order Entity â†’ OrderModel ã«å¤‰æ›
   b. session.add(model)
   c. session.commit()

7. Database ã«ä¿å­˜

8. HTTP 204 No Content ãƒ¬ã‚¹ãƒãƒ³ã‚¹
```

---

## ğŸ”‘ é‡è¦ãªæ¦‚å¿µ

### 1. ãƒãƒ¼ãƒˆï¼†ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³

```
ã€Portï¼ˆãƒãƒ¼ãƒˆï¼‰ã€‘= Interfaceï¼ˆä½•ãŒå¿…è¦ã‹ï¼‰
domain/repositories/order_repository.py

class OrderRepository(ABC):
    @abstractmethod
    def find_by_id(self, order_id: OrderId) -> Order | None:
        pass

    @abstractmethod
    def save(self, order: Order) -> None:
        pass

â†“ å®Ÿè£…

ã€Adapterï¼ˆã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ï¼‰ã€‘= å…·ä½“çš„ãªå®Ÿè£…ï¼ˆã©ã†å®Ÿç¾ã™ã‚‹ã‹ï¼‰
infrastructure/persistence/order_repository_impl.py

class OrderRepositoryImpl(OrderRepository):
    def find_by_id(self, order_id: OrderId) -> Order | None:
        # SQLAlchemyã§å®Ÿè£…
        model = self.session.get(OrderModel, order_id.value)
        return self._to_entity(model)
```

**åˆ©ç‚¹:**
- DB ã‚’ PostgreSQL â†’ MongoDB ã«å¤‰æ›´ã—ã¦ã‚‚ã€ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã¯å½±éŸ¿ãªã—
- ãƒ†ã‚¹ãƒˆæ™‚ã«ãƒ¡ãƒ¢ãƒªãƒªãƒã‚¸ãƒˆãƒªã§ä»£æ›¿å¯èƒ½
- ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ãŒæŠ€è¡“çš„è©³ç´°ã‹ã‚‰éš”é›¢ã•ã‚Œã‚‹

### 2. ä¾å­˜æ€§æ³¨å…¥ï¼ˆDIï¼‰

```python
# dependencies.py
def get_db() -> Generator[Session, None, None]:
    """DBã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’æä¾›"""
    session = SessionLocal()
    try:
        yield session
    finally:
        session.close()

def get_order_repository(
    session: Annotated[Session, Depends(get_db)]
) -> OrderRepository:
    """Repositoryå®Ÿè£…ã‚’æä¾›"""
    return OrderRepositoryImpl(session)

def get_create_order_use_case(
    repo: Annotated[OrderRepository, Depends(get_order_repository)]
) -> CreateOrderUseCase:
    """Use Caseã‚’æä¾›"""
    return CreateOrderUseCase(repo)

# router.py
@router.post("/orders")
def create_order(
    request: CreateOrderRequest,
    use_case: Annotated[CreateOrderUseCase, Depends(get_create_order_use_case)]
):
    """FastAPIãŒè‡ªå‹•ã§ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³"""
    command = CreateOrderCommand(...)
    order_id = use_case.execute(command)
    return {"order_id": str(order_id)}
```

**æµã‚Œ:**
```
ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
  â†“
FastAPIãŒä¾å­˜é–¢ä¿‚ã‚’è§£æ±º:
  1. get_db() â†’ Session
  2. get_order_repository(Session) â†’ OrderRepository
  3. get_create_order_use_case(OrderRepository) â†’ CreateOrderUseCase
  â†“
create_order(use_case) ãŒå®Ÿè¡Œã•ã‚Œã‚‹
```

### 3. Entity ã¨ Value Object

#### Entityï¼ˆã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ï¼‰
**ç‰¹å¾´:** è­˜åˆ¥å­ã‚’æŒã¤ã€å¯å¤‰ã€ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ãŒã‚ã‚‹

```python
# domain/entities/order.py
@dataclass
class Order:
    id: OrderId              # è­˜åˆ¥å­ï¼ˆåŒã˜IDãªã‚‰åŒã˜Orderï¼‰
    customer_id: CustomerId
    status: OrderStatus      # å¯å¤‰ï¼ˆçŠ¶æ…‹ãŒå¤‰ã‚ã‚‹ï¼‰
    _items: list[OrderItem]

    def add_item(self, item: OrderItem) -> None:
        """ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ã‚’å«ã‚€ãƒ¡ã‚½ãƒƒãƒ‰"""
        if self.status != OrderStatus.PENDING:
            raise OrderAlreadyConfirmedError()  # ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«
        self._items.append(item)

    def confirm(self) -> None:
        """çŠ¶æ…‹é·ç§»ã®ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«"""
        if not self._items:
            raise EmptyOrderError()
        self.status = OrderStatus.CONFIRMED
```

#### Value Objectï¼ˆå€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼‰
**ç‰¹å¾´:** è­˜åˆ¥å­ãªã—ã€ä¸å¤‰ã€å€¤ã§æ¯”è¼ƒ

```python
# shared/domain/value_objects/money.py
@dataclass(frozen=True)  # ä¸å¤‰
class Money:
    amount: Decimal
    currency: str = "JPY"

    def add(self, other: Money) -> Money:
        """æ–°ã—ã„Moneyã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’è¿”ã™ï¼ˆå…ƒã¯å¤‰æ›´ã—ãªã„ï¼‰"""
        self._check_currency(other)
        return Money(self.amount + other.amount, self.currency)

# ä½¿ç”¨ä¾‹
price1 = Money(Decimal(1000), "JPY")
price2 = Money(Decimal(1000), "JPY")
price1 == price2  # Trueï¼ˆå€¤ãŒåŒã˜ãªã‚‰åŒã˜ï¼‰

# Entityã¨ã®é•ã„
order1 = Order(id=OrderId(...))
order2 = Order(id=OrderId(...))  # åˆ¥ã®ID
order1 == order2  # Falseï¼ˆIDãŒé•ã†ã®ã§åˆ¥ç‰©ï¼‰
```

---

## âš™ï¸ è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«è©³ç´°

### pyproject.toml

**å½¹å‰²:** ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä¸­å¿ƒçš„ãªè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«

```toml
[project]
name = "fastapi-template"
version = "0.1.0"
dependencies = [
    "fastapi>=0.110.0",    # Webãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯
    "sqlalchemy>=2.0.25",   # ORM
    # ... æœ¬ç•ªä¾å­˜é–¢ä¿‚
]

[project.optional-dependencies]
dev = [
    "ruff>=0.2.0",         # Linter/Formatter
    "mypy>=1.8.0",         # å‹ãƒã‚§ãƒƒã‚¯
    "pytest>=8.0.0",       # ãƒ†ã‚¹ãƒˆ
    # ... é–‹ç™ºç”¨ä¾å­˜é–¢ä¿‚
]

[tool.ruff]                # Linterè¨­å®š
target-version = "py312"
line-length = 100

[tool.ruff.lint]
select = ["E", "W", "F", "I", "B"]  # ãƒã‚§ãƒƒã‚¯é …ç›®

[tool.mypy]                # å‹ãƒã‚§ãƒƒã‚¯è¨­å®š
python_version = "3.12"
strict = true              # å³æ ¼ãƒ¢ãƒ¼ãƒ‰

[tool.pytest.ini_options]  # ãƒ†ã‚¹ãƒˆè¨­å®š
testpaths = ["tests"]
addopts = ["--cov=app"]    # ã‚«ãƒãƒ¬ãƒƒã‚¸æ¸¬å®š
```

**ä½¿ã‚ã‚Œã‚‹å ´é¢:**
- `uv sync` â†’ dependencies ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
- `uv run ruff check .` â†’ [tool.ruff] ã‚’å‚ç…§
- `uv run mypy src/app` â†’ [tool.mypy] ã‚’å‚ç…§
- `uv run pytest` â†’ [tool.pytest.ini_options] ã‚’å‚ç…§

### Makefile

**å½¹å‰²:** é–‹ç™ºã‚¿ã‚¹ã‚¯ã®è‡ªå‹•åŒ–

```makefile
# ä¸»è¦ãªã‚¿ãƒ¼ã‚²ãƒƒãƒˆ

setup: check-uv install-dev create-env docker-up wait-db db-upgrade
    # è¤‡æ•°ã®ã‚¿ã‚¹ã‚¯ã‚’é€£é–å®Ÿè¡Œ

dev:
    uv run uvicorn app.main:app --reload
    # é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•

test:
    uv run pytest
    # ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

check: lint typecheck test
    # è¤‡æ•°ã®ãƒã‚§ãƒƒã‚¯ã‚’é †æ¬¡å®Ÿè¡Œ

commit:
    ./scripts/auto-commit.sh --interactive
    # ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å‘¼ã³å‡ºã™
```

**å¤‰æ•°å®šç¾©:**
```makefile
UV := uv
PYTHON := $(UV) run python
PYTEST := $(UV) run pytest

# $(PYTEST) ã¨æ›¸ãã¨ uv run pytest ã«å±•é–‹ã•ã‚Œã‚‹
```

### .cursorrules

**å½¹å‰²:** Cursor AIãŒè‡ªå‹•ã§èª­ã¿è¾¼ã‚€ãƒ«ãƒ¼ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«

```
ã‚³ãƒ¼ãƒ‰ç”Ÿæˆæ™‚ã«AIãŒå¿…ãšå¾“ã†ãƒ«ãƒ¼ãƒ«:

1. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‘ã‚¿ãƒ¼ãƒ³ã®é¸æŠåŸºæº–
   â†’ ã‚·ãƒ³ãƒ—ãƒ« or è¤‡é›‘ ã§åˆ¤æ–­

2. ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„
   â†’ å‹ãƒ’ãƒ³ãƒˆå¿…é ˆã€å‘½åè¦å‰‡ç­‰

3. ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã®ãƒ«ãƒ¼ãƒ«
   â†’ ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã¯Entityã«

4. Repository ãƒ‘ã‚¿ãƒ¼ãƒ³
   â†’ Interfaceï¼ˆPortï¼‰ã¨å®Ÿè£…ï¼ˆAdapterï¼‰ã‚’åˆ†é›¢

5. ç¦æ­¢äº‹é …
   â†’ ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ç¦æ­¢ã€å¾ªç’°ä¾å­˜ç¦æ­¢ç­‰
```

**å‹•ä½œ:**
```
ã‚ãªãŸ: ã€Œæ–°ã—ãæ±ºæ¸ˆæ©Ÿèƒ½ã‚’è¿½åŠ ã—ã¦ã€
         â†“
Cursor: 1. .cursorrules ã‚’èª­ã¿è¾¼ã‚€
        2. docs/ARCHITECTURE.md ã‚’å‚ç…§ã™ã‚‹ã‚ˆã†æŒ‡ç¤ºã•ã‚Œã‚‹
        3. è¤‡é›‘ãªãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã¨åˆ¤æ–­
        4. DDDãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’é¸æŠ
        5. docs/PATTERNS.md ã®ã‚³ãƒ¼ãƒ‰ä¾‹ã«å¾“ã†
        6. å‹ãƒ’ãƒ³ãƒˆã‚’å…¨ã¦ä»˜ã‘ã‚‹
        7. ãƒ†ã‚¹ãƒˆã‚‚ä¸€ç·’ã«ç”Ÿæˆ
         â†“
çµæœ: ä¸€è²«æ€§ã®ã‚ã‚‹é«˜å“è³ªãªã‚³ãƒ¼ãƒ‰ãŒç”Ÿæˆã•ã‚Œã‚‹
```

### docker-compose.yml

**å½¹å‰²:** é–‹ç™ºç’°å¢ƒã®ã‚µãƒ¼ãƒ“ã‚¹ã‚’å®šç¾©

```yaml
services:
  postgres:
    image: postgres:16-alpine
    ports: ["5432:5432"]
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
      POSTGRES_DB: fastapi_template
    volumes:
      - postgres_data:/var/lib/postgresql/data  # ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U postgres"]

  redis:
    image: redis:7-alpine
    ports: ["6379:6379"]
    volumes:
      - redis_data:/data
```

**èµ·å‹•:**
```bash
docker-compose up -d

# å®Ÿè¡Œã•ã‚Œã‚‹ã“ã¨:
1. PostgreSQLã‚³ãƒ³ãƒ†ãƒŠèµ·å‹•ï¼ˆãƒãƒ¼ãƒˆ5432ï¼‰
2. Redisã‚³ãƒ³ãƒ†ãƒŠèµ·å‹•ï¼ˆãƒãƒ¼ãƒˆ6379ï¼‰
3. ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯é–‹å§‹
4. ãƒ‡ãƒ¼ã‚¿ãƒœãƒªãƒ¥ãƒ¼ãƒ ä½œæˆï¼ˆæ°¸ç¶šåŒ–ï¼‰
```

---

## ğŸ› ï¸ ã‚¹ã‚¯ãƒªãƒ—ãƒˆè©³ç´°

### scripts/setup.sh

**å½¹å‰²:** ã‚¤ãƒ³ãƒ†ãƒªã‚¸ã‚§ãƒ³ãƒˆãªã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

```bash
å‡¦ç†ãƒ•ãƒ­ãƒ¼:

1. check_uv()
   - uvãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿ã‹ç¢ºèª
   - ãªã‘ã‚Œã°è‡ªå‹•ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

2. check_docker()
   - DockerãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ç¢ºèª
   - åœæ­¢ã—ã¦ã„ã‚Œã°è­¦å‘Š

3. install_dependencies()
   - uv sync (--all-extras)
   - pre-commit install

4. create_env_file()
   - .envãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
   - SECRET_KEY ã‚’è‡ªå‹•ç”Ÿæˆï¼ˆopenssl randï¼‰

5. start_docker()
   - docker-compose up -d
   - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®æº–å‚™ã‚’30ç§’å¾…ã¤

6. run_migrations()
   - alembic upgrade head
   - ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ

7. run_tests()
   - pytest ã§ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
   - å•é¡ŒãŒã‚ã‚Œã°æ—©æœŸæ¤œå‡º

8. print_completion_message()
   - å®Œäº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
   - æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—æ¡ˆå†…
```

**å®Ÿè¡Œ:**
```bash
./scripts/setup.sh

# ã‚ªãƒ—ã‚·ãƒ§ãƒ³
./scripts/setup.sh --prod         # æœ¬ç•ªç’°å¢ƒç”¨
./scripts/setup.sh --skip-tests   # ãƒ†ã‚¹ãƒˆã‚¹ã‚­ãƒƒãƒ—
```

### scripts/auto-commit.sh

**å½¹å‰²:** è‡ªå‹•ã‚³ãƒŸãƒƒãƒˆï¼†ãƒ—ãƒƒã‚·ãƒ¥

```bash
å‡¦ç†ãƒ•ãƒ­ãƒ¼:

1. check_changes()
   - git status ã§å¤‰æ›´ç¢ºèª
   - å¤‰æ›´ãŒãªã‘ã‚Œã°çµ‚äº†

2. run_checks()
   a. Lint
      - make lint ã§ãƒã‚§ãƒƒã‚¯
      - ã‚¨ãƒ©ãƒ¼ã‚ã‚Œã° make lint-fix
      - ä¿®æ­£ã•ã‚ŒãŸã‚‰è‡ªå‹•ã§ git add

   b. Format
      - make format ã§ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
      - ä¿®æ­£ã•ã‚ŒãŸã‚‰è‡ªå‹•ã§ git add

   c. Type check
      - make typecheck
      - ã‚¨ãƒ©ãƒ¼ã‚ã‚Œã°çµ‚äº†ï¼ˆæ‰‹å‹•ä¿®æ­£å¿…è¦ï¼‰

   d. Tests
      - make test-unit
      - å¤±æ•—ã™ã‚Œã°çµ‚äº†

3. generate_commit_message()
   - Conventional Commitså½¢å¼ã«å¤‰æ›
   - ä¾‹: feat(orders): add cancellation

4. check_doc_updates()
   - å¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ†æ
   - é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®æ›´æ–°ã‚’ææ¡ˆ
   - ä¾‹: pyproject.tomlå¤‰æ›´ â†’ TECH_STACK.mdæ›´æ–°ææ¡ˆ

5. do_commit()
   - git add -A
   - git commit
   - pre-commitãƒ•ãƒƒã‚¯å®Ÿè¡Œ
   - ãƒ•ã‚¡ã‚¤ãƒ«ä¿®æ­£ã•ã‚ŒãŸã‚‰è‡ªå‹•å†è©¦è¡Œï¼ˆæœ€å¤§3å›ï¼‰

6. git push
   - origin/ç¾åœ¨ã®ãƒ–ãƒ©ãƒ³ãƒ ã¸ãƒ—ãƒƒã‚·ãƒ¥

7. show_recent_commits()
   - æœ€è¿‘ã®ã‚³ãƒŸãƒƒãƒˆ5ä»¶è¡¨ç¤º
```

**ä½¿ç”¨ä¾‹:**
```bash
# å¯¾è©±ãƒ¢ãƒ¼ãƒ‰
make commit

# ç›´æ¥æŒ‡å®š
make commit-feat msg="add user auth"

# ã‚ªãƒ—ã‚·ãƒ§ãƒ³ä»˜ã
./scripts/auto-commit.sh feat "add feature" --scope orders --no-push
```

### scripts/hooks/pre-commit-doc-check

**å½¹å‰²:** ã‚³ãƒŸãƒƒãƒˆå‰ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ•´åˆæ€§ãƒã‚§ãƒƒã‚¯

```bash
ãƒã‚§ãƒƒã‚¯å†…å®¹:

1. pyproject.toml å¤‰æ›´
   â†’ docs/TECH_STACK.md ã‚‚æ›´æ–°ã™ã¹ãã¨è­¦å‘Š

2. domain/ å±¤ã®å¤‰æ›´
   â†’ docs/ARCHITECTURE.md, DOMAIN_MODEL.md ã‚’ç¢ºèªã™ã¹ãã¨è­¦å‘Š

3. æ–°ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«è¿½åŠ 
   â†’ å…¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®æ›´æ–°ã‚’ææ¡ˆ

4. å‹ãƒ’ãƒ³ãƒˆä¸è¶³ï¼ˆç°¡æ˜“ãƒã‚§ãƒƒã‚¯ï¼‰
   â†’ docs/CONVENTIONS.md ã‚’å‚ç…§ã™ã‚‹ã‚ˆã†è­¦å‘Š
```

**å®Ÿè¡Œã‚¿ã‚¤ãƒŸãƒ³ã‚°:**
```
git commit
  â†“
pre-commit ãƒ•ãƒƒã‚¯è‡ªå‹•å®Ÿè¡Œ
  â†“
ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒå®Ÿè¡Œã•ã‚Œã‚‹
  â†“
è­¦å‘Šè¡¨ç¤ºï¼ˆã‚³ãƒŸãƒƒãƒˆã¯ç¶™ç¶šï¼‰
```

### scripts/hooks/post-commit

**å½¹å‰²:** ã‚³ãƒŸãƒƒãƒˆå¾Œã®é€šçŸ¥

```bash
æœ€æ–°ã‚³ãƒŸãƒƒãƒˆã§å¤‰æ›´ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ†æ:

ğŸ“¦ pyproject.tomlãŒå¤‰æ›´ã•ã‚Œã¾ã—ãŸ
   docs/TECH_STACK.mdã®æ›´æ–°ã‚’æ¤œè¨ã—ã¦ãã ã•ã„

ğŸ—ï¸  ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å±¤ã«å¤‰æ›´ãŒã‚ã‚Šã¾ã—ãŸ
   docs/ARCHITECTURE.mdã®ç¢ºèªã‚’ãŠå‹§ã‚ã—ã¾ã™

ğŸ’¡ Tip: ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’æ›´æ–°ã§ãã¾ã™:
   make doc-check
   cursor docs/
```

---

## ğŸ”„ é–‹ç™ºãƒ•ãƒ­ãƒ¼ã®å…·ä½“ä¾‹

### ã‚·ãƒŠãƒªã‚ª: ã€Œæ³¨æ–‡ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ©Ÿèƒ½ã‚’è¿½åŠ ã€

#### ã‚¹ãƒ†ãƒƒãƒ—1: è¨­è¨ˆåˆ¤æ–­

```bash
# Cursorã§ç¢ºèª
ã€Œdocs/ARCHITECTURE.mdã‚’å‚ç…§ã—ã¦ã€
æ³¨æ–‡ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ©Ÿèƒ½ã¯ã©ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã§å®Ÿè£…ã™ã¹ãã§ã™ã‹ï¼Ÿã€

Cursor:
ã€Œè¤‡é›‘ãªãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ï¼ˆã‚­ãƒ£ãƒ³ã‚»ãƒ«å¯èƒ½çŠ¶æ…‹ã®åˆ¤å®šç­‰ï¼‰ãŒã‚ã‚‹ãŸã‚ã€
modules/orders/ ã®DDDãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ä½¿ç”¨ã™ã¹ãã§ã™ã€‚ã€
```

#### ã‚¹ãƒ†ãƒƒãƒ—2: ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã®å®Ÿè£…

```python
# domain/entities/order.py ã«è¿½åŠ 

def cancel(self) -> None:
    """æ³¨æ–‡ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã™ã‚‹

    Business Rules:
    - ç™ºé€æ¸ˆã¿ãƒ»é…é”æ¸ˆã¿ã¯ã‚­ãƒ£ãƒ³ã‚»ãƒ«ä¸å¯
    """
    if self.status in [OrderStatus.SHIPPED, OrderStatus.DELIVERED]:
        raise OrderCannotBeCancelledError(self.status.value)

    self.status = OrderStatus.CANCELLED

# domain/exceptions.py ã«è¿½åŠ 
class OrderCannotBeCancelledError(OrderException):
    def __init__(self, status: str) -> None:
        super().__init__(f"Cannot cancel order with status: {status}")
```

#### ã‚¹ãƒ†ãƒƒãƒ—3: Use Caseå®Ÿè£…

```python
# application/use_cases/cancel_order.pyï¼ˆæ–°è¦ä½œæˆï¼‰

@dataclass(frozen=True)
class CancelOrderCommand:
    order_id: str

class CancelOrderUseCase:
    def __init__(self, order_repo: OrderRepository):
        self.order_repo = order_repo

    def execute(self, command: CancelOrderCommand) -> None:
        # 1. æ³¨æ–‡å–å¾—
        order_id = OrderId(UUID(command.order_id))
        order = self.order_repo.find_by_id(order_id)
        if not order:
            raise OrderNotFoundException(command.order_id)

        # 2. ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯å®Ÿè¡Œï¼ˆEntityå†…ï¼‰
        order.cancel()

        # 3. æ°¸ç¶šåŒ–
        self.order_repo.save(order)
```

#### ã‚¹ãƒ†ãƒƒãƒ—4: APIå®Ÿè£…

```python
# presentation/api/router.py ã«è¿½åŠ 

@router.post("/{order_id}/cancel", status_code=status.HTTP_204_NO_CONTENT)
def cancel_order(
    order_id: str,
    use_case: Annotated[CancelOrderUseCase, Depends(get_cancel_order_use_case)]
) -> None:
    try:
        command = CancelOrderCommand(order_id=order_id)
        use_case.execute(command)
    except OrderNotFoundException as e:
        raise HTTPException(status_code=404, detail=str(e)) from e
    except OrderException as e:
        raise HTTPException(status_code=400, detail=str(e)) from e
```

#### ã‚¹ãƒ†ãƒƒãƒ—5: ãƒ†ã‚¹ãƒˆä½œæˆ

```python
# tests/unit/test_order.py ã«è¿½åŠ 

def test_cancel_order_success():
    order = Order.create(customer_id)
    order.add_item(product_id, 1, Money(Decimal(1000)))

    order.cancel()

    assert order.status == OrderStatus.CANCELLED

def test_cancel_shipped_order_raises_error():
    order = Order.create(customer_id)
    order.add_item(product_id, 1, Money(Decimal(1000)))
    order.confirm()
    order.status = OrderStatus.SHIPPED  # ç™ºé€æ¸ˆã¿ã«

    with pytest.raises(OrderCannotBeCancelledError):
        order.cancel()
```

#### ã‚¹ãƒ†ãƒƒãƒ—6: ã‚³ãƒŸãƒƒãƒˆ

```bash
# è‡ªå‹•ã§å…¨ãƒã‚§ãƒƒã‚¯å®Ÿè¡Œã—ã¦ã‚³ãƒŸãƒƒãƒˆ
make commit-feat msg="add order cancellation"

# å®Ÿè¡Œã•ã‚Œã‚‹å‡¦ç†:
1. âœ… Lintï¼ˆruffï¼‰
2. âœ… Formatï¼ˆruffï¼‰
3. âœ… Type checkï¼ˆmypyï¼‰
4. âœ… Testsï¼ˆpytestï¼‰
5. âœ… Pre-commit hooks
6. âš ï¸  ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ•´åˆæ€§ãƒã‚§ãƒƒã‚¯:
   ã€Œãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã«å¤‰æ›´ãŒã‚ã‚Šã¾ã™
    docs/DOMAIN_MODEL.mdã®æ›´æ–°ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€
7. âœ… Git commit
8. âœ… Git push
```

#### ã‚¹ãƒ†ãƒƒãƒ—7: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°

```bash
# ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’æ›´æ–°
cursor docs/DOMAIN_MODEL.md

# è¿½è¨˜å†…å®¹:
ã€Œ## Order Context

### cancel() ãƒ¡ã‚½ãƒƒãƒ‰
æ³¨æ–‡ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã™ã‚‹æ©Ÿèƒ½ã€‚
ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«:
- ç™ºé€æ¸ˆã¿ãƒ»é…é”æ¸ˆã¿ã¯ã‚­ãƒ£ãƒ³ã‚»ãƒ«ä¸å¯
- ...ã€

# ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ã‚³ãƒŸãƒƒãƒˆ
make commit-docs msg="document order cancellation feature"
```

#### ã‚¹ãƒ†ãƒƒãƒ—8: PRä½œæˆ

```bash
# GitHubã§PRä½œæˆ
# CIãŒè‡ªå‹•å®Ÿè¡Œ:
âœ… Lint and Format Check
âœ… Type Check
âœ… Test
âœ… Build

# ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ»ãƒãƒ¼ã‚¸
```

---

## ğŸ”§ å„ãƒ„ãƒ¼ãƒ«ã®å½¹å‰²

### uvï¼ˆãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ï¼‰

```bash
# ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
uv sync                    # æœ¬ç•ªä¾å­˜é–¢ä¿‚ã®ã¿
uv sync --all-extras       # é–‹ç™ºä¾å­˜é–¢ä¿‚ã‚‚å«ã‚€

# ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œ
uv run python              # venvå†…ã®Pythonã‚’å®Ÿè¡Œ
uv run pytest              # venvå†…ã®pytestã‚’å®Ÿè¡Œ
uv run uvicorn app.main:app # FastAPIèµ·å‹•

# ä¾å­˜é–¢ä¿‚ç®¡ç†
uv add fastapi             # ä¾å­˜é–¢ä¿‚è¿½åŠ 
uv remove some-package     # å‰Šé™¤
uv sync --upgrade          # å…¨ã¦æ›´æ–°
```

**ãªãœuvï¼Ÿ**
- pip/poetryã‚ˆã‚Š10-100å€é«˜é€Ÿ
- lockãƒ•ã‚¡ã‚¤ãƒ«è‡ªå‹•ç”Ÿæˆ
- ãƒ¢ãƒ€ãƒ³ã§ã‚·ãƒ³ãƒ—ãƒ«

### ruffï¼ˆLinter/Formatterï¼‰

```bash
# Lintï¼ˆã‚³ãƒ¼ãƒ‰ãƒã‚§ãƒƒã‚¯ï¼‰
uv run ruff check .           # ãƒã‚§ãƒƒã‚¯ã®ã¿
uv run ruff check --fix .     # è‡ªå‹•ä¿®æ­£

# Formatï¼ˆæ•´å½¢ï¼‰
uv run ruff format .          # ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆé©ç”¨
uv run ruff format --check .  # ãƒã‚§ãƒƒã‚¯ã®ã¿

# ãƒã‚§ãƒƒã‚¯é …ç›®ä¾‹:
- æœªä½¿ç”¨ã®import
- ã‚¤ãƒ³ãƒãƒ¼ãƒˆé †åº
- å‘½åè¦å‰‡é•å
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å•é¡Œ
- è¤‡é›‘åº¦
```

**è¨­å®š:** `pyproject.toml` ã® `[tool.ruff]`

### mypyï¼ˆå‹ãƒã‚§ãƒƒã‚¯ï¼‰

```bash
uv run mypy src/app

# ãƒã‚§ãƒƒã‚¯å†…å®¹:
- å‹ãƒ’ãƒ³ãƒˆä¸è¶³
- å‹ã®ä¸ä¸€è‡´
- æœªå®šç¾©å¤‰æ•°
- æˆ»ã‚Šå€¤ã®å‹é•å
```

**è¨­å®š:** `pyproject.toml` ã® `[tool.mypy]`

```toml
[tool.mypy]
strict = true              # å³æ ¼ãƒ¢ãƒ¼ãƒ‰
disallow_untyped_defs = true  # å‹ãƒ’ãƒ³ãƒˆå¿…é ˆ
```

### pytestï¼ˆãƒ†ã‚¹ãƒˆï¼‰

```bash
# å®Ÿè¡Œ
uv run pytest                    # å…¨ãƒ†ã‚¹ãƒˆ
uv run pytest tests/unit/        # å˜ä½“ãƒ†ã‚¹ãƒˆã®ã¿
uv run pytest --cov=app          # ã‚«ãƒãƒ¬ãƒƒã‚¸ä»˜ã
uv run pytest -v                 # è©³ç´°è¡¨ç¤º
uv run pytest -k test_order      # ç‰¹å®šã®ãƒ†ã‚¹ãƒˆã®ã¿

# ãƒãƒ¼ã‚«ãƒ¼
uv run pytest -m unit            # @pytest.mark.unit
uv run pytest -m e2e             # @pytest.mark.e2e
```

**è¨­å®š:** `pyproject.toml` ã® `[tool.pytest.ini_options]`

### Alembicï¼ˆDBãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰

```bash
# ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ä½œæˆ
uv run alembic revision --autogenerate -m "create users table"

# å‡¦ç†:
1. ç¾åœ¨ã®DBã‚¹ã‚­ãƒ¼ãƒã‚’èª­ã¿å–ã‚‹
2. models.py ã®SQLAlchemyãƒ¢ãƒ‡ãƒ«ã‚’èª­ã¿å–ã‚‹
3. å·®åˆ†ã‚’æ¤œå‡º
4. alembic/versions/xxxxx_create_users_table.py ã‚’ç”Ÿæˆ

# ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é©ç”¨
uv run alembic upgrade head

# å‡¦ç†:
1. æœªé©ç”¨ã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ¤œå‡º
2. upgrade() é–¢æ•°ã‚’é †æ¬¡å®Ÿè¡Œ
3. alembic_version ãƒ†ãƒ¼ãƒ–ãƒ«ã«è¨˜éŒ²

# ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯
uv run alembic downgrade -1  # 1ã¤å‰ã«æˆ»ã™
```

**è¨­å®š:** `alembic.ini`, `alembic/env.py`

---

## ğŸ”„ å®Ÿéš›ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼ï¼ˆå…·ä½“ä¾‹ï¼‰

### ä¾‹1: APIãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å‡¦ç†

```
ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã€‘
POST /api/v1/orders
{
  "customer_id": "550e8400-e29b-41d4-a716-446655440000"
}

ã€å‡¦ç†ãƒ•ãƒ­ãƒ¼ã€‘

1. FastAPIï¼ˆmain.pyï¼‰
   - ãƒªã‚¯ã‚¨ã‚¹ãƒˆå—ä¿¡
   - CORS ãƒã‚§ãƒƒã‚¯
   - api/v1/router.py ã¸ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

2. api/v1/router.py
   - orders router ã¸å§”è­²

3. modules/orders/presentation/api/router.py:create_order()
   - CreateOrderRequest ã§ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆPydanticï¼‰
   - customer_id ãŒ UUIDå½¢å¼ã‹è‡ªå‹•ãƒã‚§ãƒƒã‚¯
   - Depends(get_create_order_use_case) ã§ä¾å­˜æ€§æ³¨å…¥

4. ä¾å­˜æ€§æ³¨å…¥ï¼ˆè‡ªå‹•ï¼‰
   get_create_order_use_case()
     â†’ get_order_repository()
       â†’ get_db()
         â†’ Sessionç”Ÿæˆ
       â†’ OrderRepositoryImpl(session)
     â†’ CreateOrderUseCase(repository)

5. CreateOrderUseCase.execute()
   - CreateOrderCommand ã«å¤‰æ›
   - Order.create(customer_id) ã§ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ç”Ÿæˆ
   - order_repository.save(order) ã§ä¿å­˜

6. OrderRepositoryImpl.save()
   - Order Entity â†’ OrderModelï¼ˆSQLAlchemyï¼‰ã«å¤‰æ›
   - session.add(model)
   - session.commit()

7. PostgreSQL
   - INSERT INTO orders (...) VALUES (...)
   - ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã‚³ãƒŸãƒƒãƒˆ

8. ãƒ¬ã‚¹ãƒãƒ³ã‚¹
   - {"order_id": "550e8400..."}
   - HTTP 201 Created

ã€æ‰€è¦æ™‚é–“ã€‘: ç´„10-50ms
```

### ä¾‹2: é–‹ç™ºè€…ã®ã‚³ãƒŸãƒƒãƒˆä½œæ¥­

```
ã€çŠ¶æ³ã€‘æ–°æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ãŸ

1. é–‹ç™ºè€…
   $ make commit-feat msg="add payment feature"

2. scripts/auto-commit.sh å®Ÿè¡Œé–‹å§‹

3. å¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«ç¢ºèª
   ğŸ“Š å¤‰æ›´ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«:
   M  src/app/modules/payments/...
   A  tests/unit/test_payment.py

4. ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯
   a. Lintå®Ÿè¡Œ
      â†’ ã‚¨ãƒ©ãƒ¼æ¤œå‡ºï¼ˆæœªä½¿ç”¨importï¼‰
      â†’ è‡ªå‹•ä¿®æ­£
      â†’ git addï¼ˆè‡ªå‹•ï¼‰

   b. Formatå®Ÿè¡Œ
      â†’ ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆä¿®æ­£
      â†’ git addï¼ˆè‡ªå‹•ï¼‰

   c. Type check
      â†’ Success: no issues found

   d. Tests
      â†’ 20 passed

5. ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ•´åˆæ€§ãƒã‚§ãƒƒã‚¯
   âš ï¸  ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«å¤‰æ›´ãŒã‚ã‚Šã¾ã™
      docs/DOMAIN_MODEL.mdã®æ›´æ–°ã‚’æ¤œè¨ã—ã¦ãã ã•ã„

6. Git commit
   è©¦è¡Œ1: git commit
   â†’ pre-commitå®Ÿè¡Œ
   â†’ ruff ãŒã‚¤ãƒ³ãƒãƒ¼ãƒˆé †åºä¿®æ­£
   â†’ ãƒ•ã‚¡ã‚¤ãƒ«å¤‰æ›´æ¤œå‡º

   è©¦è¡Œ2: git add & git commit --no-verify
   â†’ æˆåŠŸï¼

7. Git push
   â†’ origin/main ã¸ãƒ—ãƒƒã‚·ãƒ¥

8. GitHub Actions CI è‡ªå‹•èµ·å‹•
   - Lint and Format Check âœ…
   - Type Check âœ…
   - Test âœ…
   - Build âœ…

9. å®Œäº†é€šçŸ¥
   ğŸ‰ å…¨ã¦ã®å‡¦ç†ãŒå®Œäº†ã—ã¾ã—ãŸï¼

   ğŸ“‹ æœ€è¿‘ã®ã‚³ãƒŸãƒƒãƒˆ:
   abc1234 feat: add payment feature

ã€æ‰€è¦æ™‚é–“ã€‘: ç´„30-60ç§’ï¼ˆãƒ†ã‚¹ãƒˆå«ã‚€ï¼‰
```

---

## ğŸ“ DDDã®å®Ÿè·µä¾‹

### Aggregateï¼ˆé›†ç´„ï¼‰

```python
# Order = Aggregate Rootï¼ˆé›†ç´„ãƒ«ãƒ¼ãƒˆï¼‰
# OrderItem = é›†ç´„å†…ã®Entity

class Order:  # Aggregate Root
    id: OrderId
    _items: list[OrderItem]  # å¤–éƒ¨ã‹ã‚‰ç›´æ¥è§¦ã‚Œãªã„

    def add_item(self, item: OrderItem) -> None:
        """é›†ç´„ã®å¢ƒç•Œã‚’å®ˆã‚‹"""
        # ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«: ç¢ºå®šæ¸ˆã¿ã¯è¿½åŠ ä¸å¯
        if self.status != OrderStatus.PENDING:
            raise OrderAlreadyConfirmedError()
        self._items.append(item)

    @property
    def items(self) -> list[OrderItem]:
        """èª­ã¿å–ã‚Šå°‚ç”¨ã§å…¬é–‹"""
        return self._items.copy()  # ã‚³ãƒ”ãƒ¼ã‚’è¿”ã™

# âŒ Bad: é›†ç´„ã®å¢ƒç•Œã‚’ç ´ã‚‹
order.items.append(item)  # ç›´æ¥æ“ä½œã¯ã§ããªã„

# âœ… Good: ãƒ¡ã‚½ãƒƒãƒ‰çµŒç”±
order.add_item(item)  # ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ãŒãƒã‚§ãƒƒã‚¯ã•ã‚Œã‚‹
```

**ãªãœé‡è¦ï¼Ÿ**
- æ•´åˆæ€§ã‚’ä¿è¨¼ï¼ˆãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«é•åã‚’é˜²ãï¼‰
- ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å¢ƒç•ŒãŒæ˜ç¢º
- ãƒ†ã‚¹ãƒˆã—ã‚„ã™ã„

### Bounded Contextï¼ˆå¢ƒç•Œä»˜ã‘ã‚‰ã‚ŒãŸã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆï¼‰

```
ã€Catalog Contextã€‘
å•†å“ã®ç®¡ç†ã€åœ¨åº«ç¢ºèª
â†’ modules/catalog/

ã€Order Contextã€‘
æ³¨æ–‡å‡¦ç†ã€çŠ¶æ…‹ç®¡ç†
â†’ modules/orders/

ã€æœªå®Ÿè£…ã ãŒè¿½åŠ å¯èƒ½ã€‘
- Payment Contextï¼ˆæ±ºæ¸ˆï¼‰
- Shipping Contextï¼ˆé…é€ï¼‰
- Customer Contextï¼ˆé¡§å®¢ç®¡ç†ï¼‰

å„ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã¯ç‹¬ç«‹:
- ç‹¬è‡ªã®ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«
- ç‹¬è‡ªã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ†ãƒ¼ãƒ–ãƒ«
- ç‹¬è‡ªã®API
- ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆé–“ã¯æ˜ç¢ºãªã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã§é€£æº
```

---

## ğŸ” ãƒ‡ãƒãƒƒã‚°æ–¹æ³•

### ãƒ­ã‚°ã®è¦‹æ–¹

```python
# src/app/core/logging.py ã§è¨­å®š

from app.core.logging import get_logger
logger = get_logger(__name__)

# ãƒ­ã‚°å‡ºåŠ›
logger.info(
    "order_created",
    order_id=str(order.id),
    customer_id=str(order.customer_id),
    total=float(order.calculate_total().amount)
)

# å‡ºåŠ›ï¼ˆJSONå½¢å¼ï¼‰
{
  "event": "order_created",
  "order_id": "550e8400-...",
  "customer_id": "660e8400-...",
  "total": 2500.0,
  "timestamp": "2026-01-09T14:30:00Z",
  "logger": "app.modules.orders.application.use_cases.create_order"
}
```

### ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆ

```python
# ã‚³ãƒ¼ãƒ‰å†…ã«è¿½åŠ 
def create_order(command: CreateOrderCommand) -> OrderId:
    customer_id = CustomerId(UUID(command.customer_id))

    breakpoint()  # â† ã“ã“ã§åœæ­¢

    order = Order.create(customer_id)
    return order.id

# ãƒ‡ãƒãƒƒã‚¬ãƒ¼ãŒèµ·å‹•ï¼ˆIPython/pdbï¼‰
```

### IPythonã§ã®æ¤œè¨¼

```bash
make shell

# IPythonèµ·å‹•
from app.modules.orders.domain.entities.order import Order
from app.shared.domain.value_objects.money import Money
from decimal import Decimal
from uuid import uuid4

# ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ã«è©¦ã™
order = Order.create(CustomerId(uuid4()))
order.add_item(ProductId(uuid4()), 2, Money(Decimal(1000)))
order.calculate_total()
# â†’ Money(amount=Decimal('2000'), currency='JPY')
```

---

## ğŸ“Š ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ä»•çµ„ã¿

### SQLAlchemyãƒ¢ãƒ‡ãƒ« vs ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£

```python
ã€SQLAlchemyãƒ¢ãƒ‡ãƒ«ã€‘ï¼ˆinfrastructureå±¤ï¼‰
æŠ€è¡“çš„ãªè©³ç´°ã€DBæ§‹é€ ã«å¯†çµåˆ

class OrderModel(Base):
    __tablename__ = "orders"
    id = Column(UUID(as_uuid=True), primary_key=True)
    customer_id = Column(UUID(as_uuid=True), nullable=False)
    status = Column(String(50), nullable=False)
    items = relationship("OrderItemModel")  # ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

ã€ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã€‘ï¼ˆdomainå±¤ï¼‰
ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã€DBæ§‹é€ ã¨ã¯ç„¡é–¢ä¿‚

@dataclass
class Order:
    id: OrderId
    customer_id: CustomerId
    status: OrderStatus
    _items: list[OrderItem]

    def add_item(self, item: OrderItem) -> None:
        # ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«
        if self.status != OrderStatus.PENDING:
            raise OrderAlreadyConfirmedError()
        self._items.append(item)

ã€å¤‰æ›ã€‘ï¼ˆRepositoryå®Ÿè£…ï¼‰

class OrderRepositoryImpl:
    def _to_entity(self, model: OrderModel) -> Order:
        """ORM â†’ Entity"""
        return Order(
            id=OrderId(model.id),
            customer_id=CustomerId(model.customer_id),
            status=OrderStatus(model.status),
        )

    def _to_model(self, entity: Order) -> OrderModel:
        """Entity â†’ ORM"""
        return OrderModel(
            id=entity.id.value,
            customer_id=entity.customer_id.value,
            status=entity.status.value,
        )
```

**ãªãœåˆ†é›¢ï¼Ÿ**
- ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã¯DBæ§‹é€ å¤‰æ›´ã®å½±éŸ¿ã‚’å—ã‘ãªã„
- ãƒ†ã‚¹ãƒˆæ™‚ã«DBãªã—ã§ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’ãƒ†ã‚¹ãƒˆå¯èƒ½
- ORMã‚’MongoDBã«å¤‰æ›´ã—ã¦ã‚‚ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã¯ä¸å¤‰

### ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®æµã‚Œ

```bash
# 1. ãƒ¢ãƒ‡ãƒ«å®šç¾©
class ProductModel(Base):
    __tablename__ = "products"
    id: Mapped[UUID] = ...
    name: Mapped[str] = ...

# 2. ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç”Ÿæˆ
make db-migrate msg="add products table"

# å®Ÿè¡Œå†…å®¹:
- alembic/env.py ãŒ Base.metadata ã‚’èª­ã¿å–ã‚‹
- ç¾åœ¨ã®DBã¨æ¯”è¼ƒ
- å·®åˆ†ã‹ã‚‰ upgrade()/downgrade() ã‚’ç”Ÿæˆ

# 3. ç”Ÿæˆã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«
alembic/versions/xxxxx_add_products_table.py

def upgrade() -> None:
    op.create_table('products',
        sa.Column('id', sa.UUID(), nullable=False),
        sa.Column('name', sa.String(255), nullable=False),
        sa.PrimaryKeyConstraint('id')
    )

def downgrade() -> None:
    op.drop_table('products')

# 4. é©ç”¨
make db-upgrade

# å®Ÿè¡Œå†…å®¹:
- upgrade() é–¢æ•°ã‚’å®Ÿè¡Œ
- CREATE TABLE products ...
- alembic_version ãƒ†ãƒ¼ãƒ–ãƒ«ã«è¨˜éŒ²
```

---

## ğŸ¯ å®Ÿè·µçš„ãªTips

### Tip1: æ–°ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®è¿½åŠ 

```bash
# ã‚·ãƒ³ãƒ—ãƒ«ãªæ©Ÿèƒ½ã®å ´åˆ
cp -r src/app/modules/catalog src/app/modules/reviews
# â†’ catalog/ ã‚’ãƒ™ãƒ¼ã‚¹ã«ç·¨é›†

# è¤‡é›‘ãªæ©Ÿèƒ½ã®å ´åˆ
cp -r src/app/modules/orders src/app/modules/payments
# â†’ orders/ ã‚’ãƒ™ãƒ¼ã‚¹ã«ç·¨é›†
```

### Tip2: Cursorã§ã®åŠ¹ç‡çš„ãªé–‹ç™º

```
# ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆä¾‹

ã€Œdocs/ARCHITECTURE.mdã¨docs/PATTERNS.mdã‚’å‚ç…§ã—ã¦ã€
modules/orders/ã¨åŒã˜æ§‹é€ ã§æ–°ã—ã„paymentsãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚

è¦ä»¶:
- Payment ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£
- PaymentGateway ãƒãƒ¼ãƒˆ
- Stripe/PayPal ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼
- Use Cases: ProcessPayment, RefundPayment
- ãƒ†ã‚¹ãƒˆã‚‚ä¸€ç·’ã«ç”Ÿæˆã€

â†’ CursorãŒä¸€è²«æ€§ã®ã‚ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆ
```

### Tip3: ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

```bash
# ãƒ‘ã‚¿ãƒ¼ãƒ³1: ãƒ†ã‚¹ãƒˆãŒå¤±æ•—
make test
# â†’ ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç¢ºèª
# â†’ è©²å½“ç®‡æ‰€ä¿®æ­£
make test

# ãƒ‘ã‚¿ãƒ¼ãƒ³2: å‹ãƒã‚§ãƒƒã‚¯ã‚¨ãƒ©ãƒ¼
make typecheck
# â†’ ã‚¨ãƒ©ãƒ¼ç®‡æ‰€ä¿®æ­£
# â†’ å‹ãƒ’ãƒ³ãƒˆè¿½åŠ 
make typecheck

# ãƒ‘ã‚¿ãƒ¼ãƒ³3: DBã‚¨ãƒ©ãƒ¼
make db-reset     # DBå®Œå…¨ãƒªã‚»ãƒƒãƒˆ
make db-upgrade   # ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å†é©ç”¨

# ãƒ‘ã‚¿ãƒ¼ãƒ³4: å…¨ã¦ãƒªã‚»ãƒƒãƒˆ
make clean-all    # å®Œå…¨å‰Šé™¤
make setup        # æœ€åˆã‹ã‚‰
```

---

## ğŸ“š ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ä½¿ã„åˆ†ã‘

| çŠ¶æ³ | è¦‹ã‚‹ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ | ç†ç”± |
|------|----------------|------|
| **æ¯æ—¥** | CHEATSHEET.md | ã‚³ãƒãƒ³ãƒ‰ã‚’ã™ãç¢ºèª |
| åˆå›ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ— | QUICKSTART.md | 30ç§’ã§å§‹ã‚ã‚‹ |
| AIæ´»ç”¨ã—ãŸã„ | CURSOR_GUIDE.md | åŠ¹ç‡çš„ãªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ |
| æ–°æ©Ÿèƒ½è¿½åŠ  | docs/ARCHITECTURE.md | ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ¤æ–­ |
| ã‚³ãƒ¼ãƒ‰ã®æ›¸ãæ–¹ | docs/PATTERNS.md | å®Ÿè£…ä¾‹ |
| å‘½åè¦å‰‡ | docs/CONVENTIONS.md | è¦ç´„ç¢ºèª |
| ã‚³ãƒŸãƒƒãƒˆæ–¹æ³• | docs/GIT_WORKFLOW.md | è©³ç´°ãªæ‰‹é † |
| ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ | PROJECT_OVERVIEW.md | ã“ã®ãƒ•ã‚¡ã‚¤ãƒ« |

---

## ğŸš€ é–‹ç™ºã‚µã‚¤ã‚¯ãƒ«ï¼ˆ1æ—¥ã®æµã‚Œï¼‰

```
ã€æœã€‘
$ make dev
â†’ ã‚µãƒ¼ãƒãƒ¼èµ·å‹•ï¼ˆhttp://localhost:8000ï¼‰

ã€åˆå‰ã€‘æ©Ÿèƒ½å®Ÿè£…
Cursor ã§é–‹ç™º
â†’ ã€Œdocs/ARCHITECTURE.mdã‚’å‚ç…§ã—ã¦ã€‡ã€‡æ©Ÿèƒ½ã‚’å®Ÿè£…ã€
â†’ AIãŒè‡ªå‹•ã§ãƒ‘ã‚¿ãƒ¼ãƒ³é¸æŠï¼†ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ

ã€æ˜¼å‰ã€‘ã‚³ãƒŸãƒƒãƒˆ
$ make commit
â†’ Lint/Test/Commit/Push å…¨è‡ªå‹•
â†’ GitHub Actions CI è‡ªå‹•å®Ÿè¡Œ

ã€åˆå¾Œã€‘ãƒ¬ãƒ“ãƒ¥ãƒ¼æŒ‡æ‘˜å¯¾å¿œ
$ make fix              # è‡ªå‹•ä¿®æ­£
$ make test             # ãƒ†ã‚¹ãƒˆç¢ºèª
$ make commit-fix msg="address review comments"

ã€å¤•æ–¹ã€‘ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°
$ cursor docs/DOMAIN_MODEL.md
$ make commit-docs msg="update domain model"

ã€çµ‚æ¥­ã€‘
$ make down             # Dockeråœæ­¢
```

---

## ğŸ’¡ ãªãœã“ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ï¼Ÿ

### å•é¡Œ: å¾“æ¥ã®MVCã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```python
# âŒ ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ãŒController/Serviceã«æ•£åœ¨
class OrderService:
    def create_order(self, customer_id, items):
        # ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«1: ç©ºæ³¨æ–‡ãƒã‚§ãƒƒã‚¯
        if not items:
            raise Exception("Empty order")

        # ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«2: åœ¨åº«ãƒã‚§ãƒƒã‚¯
        for item in items:
            if not self.check_stock(item):
                raise Exception("Out of stock")

        # ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«3: ä¾¡æ ¼è¨ˆç®—
        total = sum(item.price * item.qty for item in items)

        # DBä¿å­˜
        order = OrderModel(customer_id=customer_id, total=total)
        db.session.add(order)
        db.session.commit()

# å•é¡Œç‚¹:
- ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ãŒServiceã«æ•£åœ¨
- ãƒ†ã‚¹ãƒˆã—ã«ãã„ï¼ˆDBãƒ¢ãƒƒã‚¯å¿…è¦ï¼‰
- DBæ§‹é€ å¤‰æ›´ã§ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚‚å½±éŸ¿
```

### è§£æ±º: DDDã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```python
# âœ… ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ã¯Entityã«é›†ç´„
class Order:  # ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤
    def add_item(self, item: OrderItem) -> None:
        """ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«: ç¢ºå®šæ¸ˆã¿ã¯è¿½åŠ ä¸å¯"""
        if self.status != OrderStatus.PENDING:
            raise OrderAlreadyConfirmedError()
        self._items.append(item)

    def confirm(self) -> None:
        """ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«: ç©ºæ³¨æ–‡ã¯ç¢ºå®šä¸å¯"""
        if not self._items:
            raise EmptyOrderError()
        self.status = OrderStatus.CONFIRMED

    def calculate_total(self) -> Money:
        """ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«: åˆè¨ˆé‡‘é¡è¨ˆç®—"""
        total = Money(Decimal(0))
        for item in self._items:
            total = total.add(item.subtotal())
        return total

# Use Caseã¯ãƒ•ãƒ­ãƒ¼åˆ¶å¾¡ã®ã¿
class CreateOrderUseCase:  # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤
    def execute(self, command: CreateOrderCommand) -> OrderId:
        order = Order.create(customer_id)  # Entityç”Ÿæˆ
        self.repository.save(order)        # æ°¸ç¶šåŒ–
        return order.id

# åˆ©ç‚¹:
- ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ãŒ1ç®‡æ‰€ã«é›†ç´„
- DBãªã—ã§ãƒ†ã‚¹ãƒˆå¯èƒ½: order = Order.create(...); order.add_item(...)
- DBæ§‹é€ å¤‰æ›´ã®å½±éŸ¿ãªã—
```

---

## ğŸ” ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®ä»•çµ„ã¿

### JWTèªè¨¼

```python
# core/security.py

# 1. ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥åŒ–
def get_password_hash(password: str) -> str:
    return pwd_context.hash(password)  # bcrypt

# ä¿å­˜: "password123" â†’ "$2b$12$..."

# 2. ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æ¤œè¨¼
def verify_password(plain: str, hashed: str) -> bool:
    return pwd_context.verify(plain, hashed)

# 3. JWTãƒˆãƒ¼ã‚¯ãƒ³ç”Ÿæˆ
def create_access_token(data: dict) -> str:
    payload = {
        "sub": user_id,
        "exp": datetime.now() + timedelta(minutes=30)
    }
    return jwt.encode(payload, SECRET_KEY, algorithm="HS256")

# ä½¿ç”¨ä¾‹
@router.post("/login")
def login(credentials: LoginRequest):
    # 1. ãƒ¦ãƒ¼ã‚¶ãƒ¼å–å¾—
    user = get_user(credentials.email)

    # 2. ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æ¤œè¨¼
    if not verify_password(credentials.password, user.hashed_password):
        raise HTTPException(401, "Invalid credentials")

    # 3. ãƒˆãƒ¼ã‚¯ãƒ³ç”Ÿæˆ
    token = create_access_token({"sub": str(user.id)})

    return {"access_token": token, "token_type": "bearer"}

# ä¿è­·ã•ã‚ŒãŸã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
@router.get("/protected")
def protected(token: str = Depends(verify_token)):
    return {"message": "You are authenticated"}
```

---

## ğŸ§ª ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

### ãƒ†ã‚¹ãƒˆãƒ”ãƒ©ãƒŸãƒƒãƒ‰

```
      /\       E2E Testsï¼ˆå°‘æ•°ã€é…ã„ï¼‰
     /  \      - APIå…¨ä½“ã®ãƒ†ã‚¹ãƒˆ
    /â”€â”€â”€â”€\     - å®Ÿéš›ã®HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆ
   /      \
  /â”€â”€â”€â”€â”€â”€â”€â”€\   Integration Testsï¼ˆä¸­ç¨‹åº¦ï¼‰
 /          \  - Repositoryå®Ÿè£…ã®ãƒ†ã‚¹ãƒˆ
/â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\ - DBæ¥ç¶šã‚ã‚Š
              \
Unit Testsï¼ˆå¤šæ•°ã€é«˜é€Ÿï¼‰
- ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ­ã‚¸ãƒƒã‚¯ã®ãƒ†ã‚¹ãƒˆ
- å¤–éƒ¨ä¾å­˜ãªã—
```

### å…·ä½“ä¾‹

```python
# Unit Testï¼ˆãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ï¼‰- é«˜é€Ÿ
def test_order_add_item():
    # Arrange
    order = Order.create(customer_id)
    item = OrderItem(product_id, 2, Money(Decimal(1000)))

    # Act
    order.add_item(item)

    # Assert
    assert len(order.items) == 1
    assert order.calculate_total() == Money(Decimal(2000))

# ç‰¹å¾´:
- DBãªã—
- å¤–éƒ¨ä¾å­˜ãªã—
- é«˜é€Ÿï¼ˆ0.01ç§’ï¼‰
- ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®ã¿ãƒ†ã‚¹ãƒˆ

# Integration Testï¼ˆã‚¤ãƒ³ãƒ•ãƒ©å±¤ï¼‰- ä¸­é€Ÿ
def test_order_repository_save(db_session):
    # Arrange
    repo = OrderRepositoryImpl(db_session)
    order = Order.create(customer_id)

    # Act
    repo.save(order)
    found = repo.find_by_id(order.id)

    # Assert
    assert found.id == order.id

# ç‰¹å¾´:
- SQLiteï¼ˆin-memoryï¼‰ä½¿ç”¨
- Repositoryå®Ÿè£…ã‚’ãƒ†ã‚¹ãƒˆ
- ä¸­é€Ÿï¼ˆ0.1ç§’ï¼‰

# E2E Testï¼ˆAPIå…¨ä½“ï¼‰- ä½é€Ÿ
def test_create_order_api(client):
    # Act
    response = client.post("/api/v1/orders", json={
        "customer_id": str(customer_id)
    })

    # Assert
    assert response.status_code == 201
    assert "order_id" in response.json()

# ç‰¹å¾´:
- HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆ
- å…¨ãƒ¬ã‚¤ãƒ¤ãƒ¼é€šé
- ä½é€Ÿï¼ˆ0.5ç§’ï¼‰
- å®Ÿéš›ã®APIã‚’ãƒ†ã‚¹ãƒˆ
```

---

## ğŸ“ ã¾ã¨ã‚

### ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®å¼·ã¿

1. **æ®µéšçš„ãªè¤‡é›‘åº¦å¯¾å¿œ**
   - ã‚·ãƒ³ãƒ—ãƒ« â†’ catalog/ï¼ˆãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ï¼‰
   - è¤‡é›‘ â†’ orders/ï¼ˆDDDï¼‰

2. **å®Œå…¨ãªè‡ªå‹•åŒ–**
   - ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—: `make setup`
   - ã‚³ãƒŸãƒƒãƒˆ: `make commit`
   - ãƒ‡ãƒ—ãƒ­ã‚¤: GitHub Actions

3. **AIå®Œå…¨çµ±åˆ**
   - .cursorrules ã§å“è³ªæ‹…ä¿
   - ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå‚ç…§ã§ä¸€è²«æ€§

4. **é•·æœŸä¿å®ˆæ€§**
   - ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ä¿è­·
   - æŠ€è¡“çš„è©³ç´°ã‹ã‚‰éš”é›¢
   - è±Šå¯Œãªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

### ä½¿ã„æ–¹ã®ã‚³ãƒ„

1. **ã¾ãšCHEATSHEET.mdã‚’è¦‹ã‚‹**
2. **Cursorã«ã€Œdocs/å‚ç…§ã—ã¦ã€ã¨æŒ‡ç¤º**
3. **make commit ã§è‡ªå‹•åŒ–**
4. **ãƒ†ã‚¹ãƒˆã‚’æ›¸ã**
5. **å°ã•ãã‚³ãƒŸãƒƒãƒˆ**

---

**ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã€é«˜å“è³ªãªãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚’åŠ¹ç‡çš„ã«é–‹ç™ºã§ãã¾ã™ï¼ğŸš€**
